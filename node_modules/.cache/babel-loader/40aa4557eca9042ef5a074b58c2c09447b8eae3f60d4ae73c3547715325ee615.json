{"ast":null,"code":"var _jsxFileName = \"/Users/user/turn/turn-front/src/App.js\",\n  _s = $RefreshSig$();\n// App.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport { Device } from 'mediasoup-client';\nimport './App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction App() {\n  _s();\n  const [roomId, setRoomId] = useState('test-room');\n  const [userId, setUserId] = useState('user-' + Math.random().toString(36).substr(2, 9));\n  const [isConnected, setIsConnected] = useState(false);\n  const [isBroadcasting, setIsBroadcasting] = useState(false);\n  const [logs, setLogs] = useState([]);\n  const [connectionInfo, setConnectionInfo] = useState(null);\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const socketRef = useRef(null);\n  const deviceRef = useRef(null);\n  const producerTransportRef = useRef(null);\n  const consumerTransportRef = useRef(null);\n  const producersRef = useRef(new Map());\n  const consumersRef = useRef(new Map());\n  const remoteStreamsRef = useRef(new Map());\n  const localStreamRef = useRef(null);\n  const log = message => {\n    const time = new Date().toLocaleTimeString();\n    setLogs(prev => [...prev, `[${time}] ${message}`]);\n    console.log(`[${time}] ${message}`);\n  };\n  const connect = async () => {\n    try {\n      log('Connecting to API...');\n      const response = await fetch('http://localhost:3000/api/video/connect', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          roomId,\n          userId\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const data = await response.json();\n      setConnectionInfo(data);\n      setIsConnected(true);\n      log('API Response received');\n      log(`Broadcaster URL: ${data.broadcaster.url}`);\n    } catch (error) {\n      log(`Error: ${error.message}`);\n    }\n  };\n  const disconnect = () => {\n    if (localStreamRef.current) {\n      localStreamRef.current.getTracks().forEach(track => track.stop());\n      localVideoRef.current.srcObject = null;\n    }\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n    setIsConnected(false);\n    setIsBroadcasting(false);\n    setConnectionInfo(null);\n    log('Disconnected');\n  };\n  const startBroadcast = async () => {\n    try {\n      log('Starting broadcast...');\n\n      // Get user media\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: 640,\n          height: 480\n        },\n        audio: true\n      });\n      localStreamRef.current = stream;\n      localVideoRef.current.srcObject = stream;\n      log('Got local media stream');\n\n      // Connect to socket\n      const url = new URL(connectionInfo.broadcaster.url);\n      const socketUrl = `${url.protocol}//${url.host}`;\n      log(`Connecting to socket: ${socketUrl}`);\n      socketRef.current = io(socketUrl, {\n        path: '/socket.io/',\n        query: {\n          token: connectionInfo.broadcaster.token\n        },\n        transports: ['websocket', 'polling']\n      });\n      socketRef.current.on('connect', () => {\n        log('âœ… Socket connected! ID: ' + socketRef.current.id);\n      });\n      socketRef.current.on('connect_error', error => {\n        log(`âŒ Socket connection error: ${error.message}`);\n      });\n      socketRef.current.on('routerCapabilities', async rtpCapabilities => {\n        log('Received router capabilities');\n\n        // Create device\n        deviceRef.current = new Device();\n        await deviceRef.current.load({\n          routerRtpCapabilities: rtpCapabilities\n        });\n        log('Device loaded');\n\n        // Create producer transport\n        await createProducerTransport();\n\n        // Now that we're ready, ask for existing producers\n        socketRef.current.emit('getProducers', producers => {\n          log(`Found ${producers.length} existing producers`);\n          producers.forEach(({\n            producerId,\n            userId: remoteUserId,\n            kind\n          }) => {\n            if (remoteUserId !== userId) {\n              log(`Found existing producer from ${remoteUserId}`);\n              socketRef.current.emit('newProducer', {\n                producerId,\n                userId: remoteUserId,\n                kind\n              });\n            }\n          });\n        });\n      });\n      socketRef.current.on('newProducer', async ({\n        producerId,\n        userId: remoteUserId,\n        kind\n      }) => {\n        log(`ðŸŽ¥ NEW PRODUCER DETECTED: ${remoteUserId} (${kind})`);\n        if (remoteUserId === userId) {\n          log('Skipping own stream');\n          return;\n        }\n        if (!consumerTransportRef.current) {\n          await createConsumerTransport();\n        }\n        await consumeStream(producerId);\n      });\n      socketRef.current.onAny((eventName, ...args) => {\n        log(`ðŸ“¨ Socket event: ${eventName}`);\n      });\n      setIsBroadcasting(true);\n    } catch (error) {\n      log(`Broadcast error: ${error.message}`);\n    }\n  };\n  const createProducerTransport = async () => {\n    return new Promise((resolve, reject) => {\n      socketRef.current.emit('createTransport', {\n        producing: true,\n        consuming: false\n      }, async response => {\n        if (response.error) {\n          reject(new Error(response.error));\n          return;\n        }\n        log('Producer transport created');\n        producerTransportRef.current = deviceRef.current.createSendTransport({\n          id: response.id,\n          iceParameters: response.iceParameters,\n          iceCandidates: response.iceCandidates,\n          dtlsParameters: response.dtlsParameters,\n          iceServers: [connectionInfo.broadcaster.ice]\n        });\n        producerTransportRef.current.on('connect', ({\n          dtlsParameters\n        }, callback, errback) => {\n          socketRef.current.emit('connectTransport', {\n            transportId: producerTransportRef.current.id,\n            dtlsParameters\n          }, response => {\n            if (response.error) {\n              errback(new Error(response.error));\n            } else {\n              callback();\n            }\n          });\n        });\n        producerTransportRef.current.on('produce', ({\n          kind,\n          rtpParameters\n        }, callback, errback) => {\n          socketRef.current.emit('produce', {\n            transportId: producerTransportRef.current.id,\n            kind,\n            rtpParameters\n          }, response => {\n            if (response.error) {\n              errback(new Error(response.error));\n            } else {\n              callback({\n                id: response.id\n              });\n            }\n          });\n        });\n\n        // Start producing\n        const videoTrack = localStreamRef.current.getVideoTracks()[0];\n        const audioTrack = localStreamRef.current.getAudioTracks()[0];\n        if (videoTrack) {\n          const producer = await producerTransportRef.current.produce({\n            track: videoTrack\n          });\n          producersRef.current.set('video', producer);\n          log('Video producer created');\n        }\n        if (audioTrack) {\n          const producer = await producerTransportRef.current.produce({\n            track: audioTrack\n          });\n          producersRef.current.set('audio', producer);\n          log('Audio producer created');\n        }\n\n        // After we start producing, check for other producers in the room\n        log('Checking for other producers in the room...');\n        socketRef.current.emit('refresh-producers');\n        resolve();\n      });\n    });\n  };\n  const createConsumerTransport = async () => {\n    return new Promise((resolve, reject) => {\n      socketRef.current.emit('createTransport', {\n        producing: false,\n        consuming: true\n      }, async response => {\n        if (response.error) {\n          reject(new Error(response.error));\n          return;\n        }\n        log('Consumer transport created');\n        consumerTransportRef.current = deviceRef.current.createRecvTransport({\n          id: response.id,\n          iceParameters: response.iceParameters,\n          iceCandidates: response.iceCandidates,\n          dtlsParameters: response.dtlsParameters,\n          iceServers: [connectionInfo.broadcaster.ice]\n        });\n        consumerTransportRef.current.on('connect', ({\n          dtlsParameters\n        }, callback, errback) => {\n          socketRef.current.emit('connectTransport', {\n            transportId: consumerTransportRef.current.id,\n            dtlsParameters\n          }, response => {\n            if (response.error) {\n              errback(new Error(response.error));\n            } else {\n              callback();\n            }\n          });\n        });\n        resolve();\n      });\n    });\n  };\n  const consumeStream = async producerId => {\n    log(`Attempting to consume stream: ${producerId}`);\n    socketRef.current.emit('consume', {\n      producerId,\n      rtpCapabilities: deviceRef.current.rtpCapabilities\n    }, async response => {\n      if (response.error) {\n        log(`âŒ Error consuming: ${response.error}`);\n        return;\n      }\n      log(`âœ… Consumer created: ${response.id} for producer ${response.producerId}`);\n      const consumer = await consumerTransportRef.current.consume({\n        id: response.id,\n        producerId: response.producerId,\n        kind: response.kind,\n        rtpParameters: response.rtpParameters\n      });\n      consumersRef.current.set(consumer.id, consumer);\n\n      // Create or update stream for this producer\n      if (!remoteStreamsRef.current.has(producerId)) {\n        remoteStreamsRef.current.set(producerId, new MediaStream());\n      }\n      remoteStreamsRef.current.get(producerId).addTrack(consumer.track);\n\n      // Update remote video\n      updateRemoteVideo();\n      log(`âœ… Successfully consuming ${response.kind} from producer ${producerId}`);\n    });\n  };\n  const updateRemoteVideo = () => {\n    // Only show remote streams, not local\n    const remoteTracks = [];\n    for (const [producerId, stream] of remoteStreamsRef.current) {\n      stream.getTracks().forEach(track => {\n        var _localStreamRef$curre;\n        // Make sure we're not adding our own tracks\n        const isLocalTrack = (_localStreamRef$curre = localStreamRef.current) === null || _localStreamRef$curre === void 0 ? void 0 : _localStreamRef$curre.getTracks().some(localTrack => localTrack.id === track.id);\n        if (!isLocalTrack) {\n          remoteTracks.push(track);\n        }\n      });\n    }\n    if (remoteTracks.length > 0) {\n      const combinedStream = new MediaStream(remoteTracks);\n      remoteVideoRef.current.srcObject = combinedStream;\n      log(`Remote video updated with ${remoteTracks.length} tracks`);\n    }\n  };\n  const stopBroadcast = () => {\n    if (localStreamRef.current) {\n      localStreamRef.current.getTracks().forEach(track => track.stop());\n      localVideoRef.current.srcObject = null;\n    }\n    if (producerTransportRef.current) {\n      producerTransportRef.current.close();\n    }\n    if (consumerTransportRef.current) {\n      consumerTransportRef.current.close();\n    }\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n    }\n    producersRef.current.clear();\n    consumersRef.current.clear();\n    remoteStreamsRef.current.clear();\n    setIsBroadcasting(false);\n    log('Broadcast stopped');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Video Streaming Test (React)\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"section\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"1. Connect to Stream\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Room ID\",\n          value: roomId,\n          onChange: e => setRoomId(e.target.value),\n          disabled: isConnected\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"User ID\",\n          value: userId,\n          onChange: e => setUserId(e.target.value),\n          disabled: isConnected\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 11\n        }, this), !isConnected ? /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: connect,\n          children: \"Connect\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: disconnect,\n          children: \"Disconnect\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 9\n      }, this), connectionInfo && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"response\",\n        children: /*#__PURE__*/_jsxDEV(\"pre\", {\n          children: JSON.stringify(connectionInfo, null, 2)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"section\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"2. Broadcast\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"controls\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: startBroadcast,\n          disabled: !isConnected || isBroadcasting,\n          children: \"Start Broadcasting\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: stopBroadcast,\n          disabled: !isBroadcasting,\n          children: \"Stop Broadcasting\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"section\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"3. Video\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"video-box\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status\",\n            children: \"Local Stream\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 405,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n            ref: localVideoRef,\n            autoPlay: true,\n            muted: true,\n            playsInline: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"video-box\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status\",\n            children: \"Remote Stream\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 409,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n            ref: remoteVideoRef,\n            autoPlay: true,\n            playsInline: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 410,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"section\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"4. Logs\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"log\",\n        children: logs.map((log, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          children: log\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 349,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"PAeh2OH6BEOAAGgWJj9uZ1WwdRU=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useRef","useEffect","io","Device","jsxDEV","_jsxDEV","App","_s","roomId","setRoomId","userId","setUserId","Math","random","toString","substr","isConnected","setIsConnected","isBroadcasting","setIsBroadcasting","logs","setLogs","connectionInfo","setConnectionInfo","localVideoRef","remoteVideoRef","socketRef","deviceRef","producerTransportRef","consumerTransportRef","producersRef","Map","consumersRef","remoteStreamsRef","localStreamRef","log","message","time","Date","toLocaleTimeString","prev","console","connect","response","fetch","method","headers","body","JSON","stringify","ok","Error","status","data","json","broadcaster","url","error","disconnect","current","getTracks","forEach","track","stop","srcObject","startBroadcast","stream","navigator","mediaDevices","getUserMedia","video","width","height","audio","URL","socketUrl","protocol","host","path","query","token","transports","on","id","rtpCapabilities","load","routerRtpCapabilities","createProducerTransport","emit","producers","length","producerId","remoteUserId","kind","createConsumerTransport","consumeStream","onAny","eventName","args","Promise","resolve","reject","producing","consuming","createSendTransport","iceParameters","iceCandidates","dtlsParameters","iceServers","ice","callback","errback","transportId","rtpParameters","videoTrack","getVideoTracks","audioTrack","getAudioTracks","producer","produce","set","createRecvTransport","consumer","consume","has","MediaStream","get","addTrack","updateRemoteVideo","remoteTracks","_localStreamRef$curre","isLocalTrack","some","localTrack","push","combinedStream","stopBroadcast","close","clear","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","value","onChange","e","target","disabled","onClick","ref","autoPlay","muted","playsInline","map","index","_c","$RefreshReg$"],"sources":["/Users/user/turn/turn-front/src/App.js"],"sourcesContent":["// App.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport { Device } from 'mediasoup-client';\nimport './App.css';\n\nfunction App() {\n  const [roomId, setRoomId] = useState('test-room');\n  const [userId, setUserId] = useState('user-' + Math.random().toString(36).substr(2, 9));\n  const [isConnected, setIsConnected] = useState(false);\n  const [isBroadcasting, setIsBroadcasting] = useState(false);\n  const [logs, setLogs] = useState([]);\n  const [connectionInfo, setConnectionInfo] = useState(null);\n\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const socketRef = useRef(null);\n  const deviceRef = useRef(null);\n  const producerTransportRef = useRef(null);\n  const consumerTransportRef = useRef(null);\n  const producersRef = useRef(new Map());\n  const consumersRef = useRef(new Map());\n  const remoteStreamsRef = useRef(new Map());\n  const localStreamRef = useRef(null);\n\n  const log = (message) => {\n    const time = new Date().toLocaleTimeString();\n    setLogs(prev => [...prev, `[${time}] ${message}`]);\n    console.log(`[${time}] ${message}`);\n  };\n\n  const connect = async () => {\n    try {\n      log('Connecting to API...');\n\n      const response = await fetch('http://localhost:3000/api/video/connect', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ roomId, userId })\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      setConnectionInfo(data);\n      setIsConnected(true);\n      log('API Response received');\n      log(`Broadcaster URL: ${data.broadcaster.url}`);\n    } catch (error) {\n      log(`Error: ${error.message}`);\n    }\n  };\n\n  const disconnect = () => {\n    if (localStreamRef.current) {\n      localStreamRef.current.getTracks().forEach(track => track.stop());\n      localVideoRef.current.srcObject = null;\n    }\n\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n    }\n\n    setIsConnected(false);\n    setIsBroadcasting(false);\n    setConnectionInfo(null);\n    log('Disconnected');\n  };\n\n  const startBroadcast = async () => {\n    try {\n      log('Starting broadcast...');\n\n      // Get user media\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { width: 640, height: 480 },\n        audio: true\n      });\n\n      localStreamRef.current = stream;\n      localVideoRef.current.srcObject = stream;\n      log('Got local media stream');\n\n      // Connect to socket\n      const url = new URL(connectionInfo.broadcaster.url);\n      const socketUrl = `${url.protocol}//${url.host}`;\n      \n      log(`Connecting to socket: ${socketUrl}`);\n\n      socketRef.current = io(socketUrl, {\n        path: '/socket.io/',\n        query: { token: connectionInfo.broadcaster.token },\n        transports: ['websocket', 'polling']\n      });\n\n      socketRef.current.on('connect', () => {\n        log('âœ… Socket connected! ID: ' + socketRef.current.id);\n      });\n\n      socketRef.current.on('connect_error', (error) => {\n        log(`âŒ Socket connection error: ${error.message}`);\n      });\n\n      socketRef.current.on('routerCapabilities', async (rtpCapabilities) => {\n        log('Received router capabilities');\n\n        // Create device\n        deviceRef.current = new Device();\n        await deviceRef.current.load({ routerRtpCapabilities: rtpCapabilities });\n        log('Device loaded');\n\n        // Create producer transport\n        await createProducerTransport();\n        \n        // Now that we're ready, ask for existing producers\n        socketRef.current.emit('getProducers', (producers) => {\n          log(`Found ${producers.length} existing producers`);\n          producers.forEach(({ producerId, userId: remoteUserId, kind }) => {\n            if (remoteUserId !== userId) {\n              log(`Found existing producer from ${remoteUserId}`);\n              socketRef.current.emit('newProducer', { producerId, userId: remoteUserId, kind });\n            }\n          });\n        });\n      });\n\n      socketRef.current.on('newProducer', async ({ producerId, userId: remoteUserId, kind }) => {\n        log(`ðŸŽ¥ NEW PRODUCER DETECTED: ${remoteUserId} (${kind})`);\n        \n        if (remoteUserId === userId) {\n          log('Skipping own stream');\n          return;\n        }\n\n        if (!consumerTransportRef.current) {\n          await createConsumerTransport();\n        }\n\n        await consumeStream(producerId);\n      });\n\n      socketRef.current.onAny((eventName, ...args) => {\n        log(`ðŸ“¨ Socket event: ${eventName}`);\n      });\n\n      setIsBroadcasting(true);\n    } catch (error) {\n      log(`Broadcast error: ${error.message}`);\n    }\n  };\n\n  const createProducerTransport = async () => {\n    return new Promise((resolve, reject) => {\n      socketRef.current.emit('createTransport', { producing: true, consuming: false }, async (response) => {\n        if (response.error) {\n          reject(new Error(response.error));\n          return;\n        }\n\n        log('Producer transport created');\n\n        producerTransportRef.current = deviceRef.current.createSendTransport({\n          id: response.id,\n          iceParameters: response.iceParameters,\n          iceCandidates: response.iceCandidates,\n          dtlsParameters: response.dtlsParameters,\n          iceServers: [connectionInfo.broadcaster.ice]\n        });\n\n        producerTransportRef.current.on('connect', ({ dtlsParameters }, callback, errback) => {\n          socketRef.current.emit('connectTransport', {\n            transportId: producerTransportRef.current.id,\n            dtlsParameters\n          }, (response) => {\n            if (response.error) {\n              errback(new Error(response.error));\n            } else {\n              callback();\n            }\n          });\n        });\n\n        producerTransportRef.current.on('produce', ({ kind, rtpParameters }, callback, errback) => {\n          socketRef.current.emit('produce', {\n            transportId: producerTransportRef.current.id,\n            kind,\n            rtpParameters\n          }, (response) => {\n            if (response.error) {\n              errback(new Error(response.error));\n            } else {\n              callback({ id: response.id });\n            }\n          });\n        });\n\n        // Start producing\n        const videoTrack = localStreamRef.current.getVideoTracks()[0];\n        const audioTrack = localStreamRef.current.getAudioTracks()[0];\n\n        if (videoTrack) {\n          const producer = await producerTransportRef.current.produce({ track: videoTrack });\n          producersRef.current.set('video', producer);\n          log('Video producer created');\n        }\n\n        if (audioTrack) {\n          const producer = await producerTransportRef.current.produce({ track: audioTrack });\n          producersRef.current.set('audio', producer);\n          log('Audio producer created');\n        }\n\n        // After we start producing, check for other producers in the room\n        log('Checking for other producers in the room...');\n        socketRef.current.emit('refresh-producers');\n\n        resolve();\n      });\n    });\n  };\n\n  const createConsumerTransport = async () => {\n    return new Promise((resolve, reject) => {\n      socketRef.current.emit('createTransport', { producing: false, consuming: true }, async (response) => {\n        if (response.error) {\n          reject(new Error(response.error));\n          return;\n        }\n\n        log('Consumer transport created');\n\n        consumerTransportRef.current = deviceRef.current.createRecvTransport({\n          id: response.id,\n          iceParameters: response.iceParameters,\n          iceCandidates: response.iceCandidates,\n          dtlsParameters: response.dtlsParameters,\n          iceServers: [connectionInfo.broadcaster.ice]\n        });\n\n        consumerTransportRef.current.on('connect', ({ dtlsParameters }, callback, errback) => {\n          socketRef.current.emit('connectTransport', {\n            transportId: consumerTransportRef.current.id,\n            dtlsParameters\n          }, (response) => {\n            if (response.error) {\n              errback(new Error(response.error));\n            } else {\n              callback();\n            }\n          });\n        });\n\n        resolve();\n      });\n    });\n  };\n\n  const consumeStream = async (producerId) => {\n    log(`Attempting to consume stream: ${producerId}`);\n\n    socketRef.current.emit('consume', {\n      producerId,\n      rtpCapabilities: deviceRef.current.rtpCapabilities\n    }, async (response) => {\n      if (response.error) {\n        log(`âŒ Error consuming: ${response.error}`);\n        return;\n      }\n\n      log(`âœ… Consumer created: ${response.id} for producer ${response.producerId}`);\n\n      const consumer = await consumerTransportRef.current.consume({\n        id: response.id,\n        producerId: response.producerId,\n        kind: response.kind,\n        rtpParameters: response.rtpParameters\n      });\n\n      consumersRef.current.set(consumer.id, consumer);\n\n      // Create or update stream for this producer\n      if (!remoteStreamsRef.current.has(producerId)) {\n        remoteStreamsRef.current.set(producerId, new MediaStream());\n      }\n      \n      remoteStreamsRef.current.get(producerId).addTrack(consumer.track);\n      \n      // Update remote video\n      updateRemoteVideo();\n\n      log(`âœ… Successfully consuming ${response.kind} from producer ${producerId}`);\n    });\n  };\n\n  const updateRemoteVideo = () => {\n    // Only show remote streams, not local\n    const remoteTracks = [];\n    \n    for (const [producerId, stream] of remoteStreamsRef.current) {\n      stream.getTracks().forEach(track => {\n        // Make sure we're not adding our own tracks\n        const isLocalTrack = localStreamRef.current?.getTracks().some(localTrack => \n          localTrack.id === track.id\n        );\n        \n        if (!isLocalTrack) {\n          remoteTracks.push(track);\n        }\n      });\n    }\n\n    if (remoteTracks.length > 0) {\n      const combinedStream = new MediaStream(remoteTracks);\n      remoteVideoRef.current.srcObject = combinedStream;\n      log(`Remote video updated with ${remoteTracks.length} tracks`);\n    }\n  };\n\n  const stopBroadcast = () => {\n    if (localStreamRef.current) {\n      localStreamRef.current.getTracks().forEach(track => track.stop());\n      localVideoRef.current.srcObject = null;\n    }\n\n    if (producerTransportRef.current) {\n      producerTransportRef.current.close();\n    }\n\n    if (consumerTransportRef.current) {\n      consumerTransportRef.current.close();\n    }\n\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n    }\n\n    producersRef.current.clear();\n    consumersRef.current.clear();\n    remoteStreamsRef.current.clear();\n\n    setIsBroadcasting(false);\n    log('Broadcast stopped');\n  };\n\n  return (\n    <div className=\"App\">\n      <h1>Video Streaming Test (React)</h1>\n      \n      <div className=\"section\">\n        <h2>1. Connect to Stream</h2>\n        <div className=\"controls\">\n          <input \n            type=\"text\" \n            placeholder=\"Room ID\" \n            value={roomId}\n            onChange={(e) => setRoomId(e.target.value)}\n            disabled={isConnected}\n          />\n          <input \n            type=\"text\" \n            placeholder=\"User ID\" \n            value={userId}\n            onChange={(e) => setUserId(e.target.value)}\n            disabled={isConnected}\n          />\n          {!isConnected ? (\n            <button onClick={connect}>Connect</button>\n          ) : (\n            <button onClick={disconnect}>Disconnect</button>\n          )}\n        </div>\n        \n        {connectionInfo && (\n          <div className=\"response\">\n            <pre>{JSON.stringify(connectionInfo, null, 2)}</pre>\n          </div>\n        )}\n      </div>\n\n      <div className=\"section\">\n        <h2>2. Broadcast</h2>\n        <div className=\"controls\">\n          <button \n            onClick={startBroadcast} \n            disabled={!isConnected || isBroadcasting}\n          >\n            Start Broadcasting\n          </button>\n          <button \n            onClick={stopBroadcast} \n            disabled={!isBroadcasting}\n          >\n            Stop Broadcasting\n          </button>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <h2>3. Video</h2>\n        <div className=\"video-container\">\n          <div className=\"video-box\">\n            <div className=\"status\">Local Stream</div>\n            <video ref={localVideoRef} autoPlay muted playsInline />\n          </div>\n          <div className=\"video-box\">\n            <div className=\"status\">Remote Stream</div>\n            <video ref={remoteVideoRef} autoPlay playsInline />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"section\">\n        <h2>4. Logs</h2>\n        <div className=\"log\">\n          {logs.map((log, index) => (\n            <div key={index}>{log}</div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}