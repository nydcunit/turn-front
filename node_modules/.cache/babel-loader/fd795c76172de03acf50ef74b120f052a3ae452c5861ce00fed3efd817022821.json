{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRtpEncodings = getRtpEncodings;\nexports.addLegacySimulcast = addLegacySimulcast;\nfunction getRtpEncodings({\n  offerMediaObject\n}) {\n  const ssrcs = new Set();\n  for (const line of offerMediaObject.ssrcs ?? []) {\n    const ssrc = line.id;\n    ssrcs.add(ssrc);\n  }\n  if (ssrcs.size === 0) {\n    throw new Error('no a=ssrc lines found');\n  }\n  const ssrcToRtxSsrc = new Map();\n  // First assume RTX is used.\n  for (const line of offerMediaObject.ssrcGroups ?? []) {\n    if (line.semantics !== 'FID') {\n      continue;\n    }\n    let [ssrc, rtxSsrc] = line.ssrcs.split(/\\s+/);\n    ssrc = Number(ssrc);\n    rtxSsrc = Number(rtxSsrc);\n    if (ssrcs.has(ssrc)) {\n      // Remove both the SSRC and RTX SSRC from the set so later we know\n      // that they are already handled.\n      ssrcs.delete(ssrc);\n      ssrcs.delete(rtxSsrc);\n      // Add to the map.\n      ssrcToRtxSsrc.set(ssrc, rtxSsrc);\n    }\n  }\n  // If the set of SSRCs is not empty it means that RTX is not being used, so\n  // take media SSRCs from there.\n  for (const ssrc of ssrcs) {\n    // Add to the map.\n    ssrcToRtxSsrc.set(ssrc, null);\n  }\n  const encodings = [];\n  for (const [ssrc, rtxSsrc] of ssrcToRtxSsrc) {\n    const encoding = {\n      ssrc\n    };\n    if (rtxSsrc) {\n      encoding.rtx = {\n        ssrc: rtxSsrc\n      };\n    }\n    encodings.push(encoding);\n  }\n  return encodings;\n}\n/**\n * Adds multi-ssrc based simulcast into the given SDP media section offer.\n */\nfunction addLegacySimulcast({\n  offerMediaObject,\n  numStreams\n}) {\n  if (numStreams <= 1) {\n    throw new TypeError('numStreams must be greater than 1');\n  }\n  // Get the SSRC.\n  const ssrcMsidLine = (offerMediaObject.ssrcs ?? []).find(line => line.attribute === 'msid');\n  if (!ssrcMsidLine) {\n    throw new Error('a=ssrc line with msid information not found');\n  }\n  const [streamId, trackId] = ssrcMsidLine.value.split(' ');\n  const firstSsrc = Number(ssrcMsidLine.id);\n  let firstRtxSsrc;\n  // Get the SSRC for RTX.\n  (offerMediaObject.ssrcGroups ?? []).some(line => {\n    if (line.semantics !== 'FID') {\n      return false;\n    }\n    const ssrcs = line.ssrcs.split(/\\s+/);\n    if (Number(ssrcs[0]) === firstSsrc) {\n      firstRtxSsrc = Number(ssrcs[1]);\n      return true;\n    } else {\n      return false;\n    }\n  });\n  const ssrcCnameLine = offerMediaObject.ssrcs.find(line => line.attribute === 'cname');\n  if (!ssrcCnameLine) {\n    throw new Error('a=ssrc line with cname information not found');\n  }\n  const cname = ssrcCnameLine.value;\n  const ssrcs = [];\n  const rtxSsrcs = [];\n  for (let i = 0; i < numStreams; ++i) {\n    ssrcs.push(firstSsrc + i);\n    if (firstRtxSsrc) {\n      rtxSsrcs.push(firstRtxSsrc + i);\n    }\n  }\n  offerMediaObject.ssrcGroups = [];\n  offerMediaObject.ssrcs = [];\n  offerMediaObject.ssrcGroups.push({\n    semantics: 'SIM',\n    ssrcs: ssrcs.join(' ')\n  });\n  for (const ssrc of ssrcs) {\n    offerMediaObject.ssrcs.push({\n      id: ssrc,\n      attribute: 'cname',\n      value: cname\n    });\n    offerMediaObject.ssrcs.push({\n      id: ssrc,\n      attribute: 'msid',\n      value: `${streamId} ${trackId}`\n    });\n  }\n  for (let i = 0; i < rtxSsrcs.length; ++i) {\n    const ssrc = ssrcs[i];\n    const rtxSsrc = rtxSsrcs[i];\n    offerMediaObject.ssrcs.push({\n      id: rtxSsrc,\n      attribute: 'cname',\n      value: cname\n    });\n    offerMediaObject.ssrcs.push({\n      id: rtxSsrc,\n      attribute: 'msid',\n      value: `${streamId} ${trackId}`\n    });\n    offerMediaObject.ssrcGroups.push({\n      semantics: 'FID',\n      ssrcs: `${ssrc} ${rtxSsrc}`\n    });\n  }\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","getRtpEncodings","addLegacySimulcast","offerMediaObject","ssrcs","Set","line","ssrc","id","add","size","Error","ssrcToRtxSsrc","Map","ssrcGroups","semantics","rtxSsrc","split","Number","has","delete","set","encodings","encoding","rtx","push","numStreams","TypeError","ssrcMsidLine","find","attribute","streamId","trackId","firstSsrc","firstRtxSsrc","some","ssrcCnameLine","cname","rtxSsrcs","i","join","length"],"sources":["/Users/user/turn/turn-front/node_modules/mediasoup-client/lib/handlers/sdp/unifiedPlanUtils.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getRtpEncodings = getRtpEncodings;\nexports.addLegacySimulcast = addLegacySimulcast;\nfunction getRtpEncodings({ offerMediaObject, }) {\n    const ssrcs = new Set();\n    for (const line of offerMediaObject.ssrcs ?? []) {\n        const ssrc = line.id;\n        ssrcs.add(ssrc);\n    }\n    if (ssrcs.size === 0) {\n        throw new Error('no a=ssrc lines found');\n    }\n    const ssrcToRtxSsrc = new Map();\n    // First assume RTX is used.\n    for (const line of offerMediaObject.ssrcGroups ?? []) {\n        if (line.semantics !== 'FID') {\n            continue;\n        }\n        let [ssrc, rtxSsrc] = line.ssrcs.split(/\\s+/);\n        ssrc = Number(ssrc);\n        rtxSsrc = Number(rtxSsrc);\n        if (ssrcs.has(ssrc)) {\n            // Remove both the SSRC and RTX SSRC from the set so later we know\n            // that they are already handled.\n            ssrcs.delete(ssrc);\n            ssrcs.delete(rtxSsrc);\n            // Add to the map.\n            ssrcToRtxSsrc.set(ssrc, rtxSsrc);\n        }\n    }\n    // If the set of SSRCs is not empty it means that RTX is not being used, so\n    // take media SSRCs from there.\n    for (const ssrc of ssrcs) {\n        // Add to the map.\n        ssrcToRtxSsrc.set(ssrc, null);\n    }\n    const encodings = [];\n    for (const [ssrc, rtxSsrc] of ssrcToRtxSsrc) {\n        const encoding = { ssrc };\n        if (rtxSsrc) {\n            encoding.rtx = { ssrc: rtxSsrc };\n        }\n        encodings.push(encoding);\n    }\n    return encodings;\n}\n/**\n * Adds multi-ssrc based simulcast into the given SDP media section offer.\n */\nfunction addLegacySimulcast({ offerMediaObject, numStreams, }) {\n    if (numStreams <= 1) {\n        throw new TypeError('numStreams must be greater than 1');\n    }\n    // Get the SSRC.\n    const ssrcMsidLine = (offerMediaObject.ssrcs ?? []).find((line) => line.attribute === 'msid');\n    if (!ssrcMsidLine) {\n        throw new Error('a=ssrc line with msid information not found');\n    }\n    const [streamId, trackId] = ssrcMsidLine.value.split(' ');\n    const firstSsrc = Number(ssrcMsidLine.id);\n    let firstRtxSsrc;\n    // Get the SSRC for RTX.\n    (offerMediaObject.ssrcGroups ?? []).some((line) => {\n        if (line.semantics !== 'FID') {\n            return false;\n        }\n        const ssrcs = line.ssrcs.split(/\\s+/);\n        if (Number(ssrcs[0]) === firstSsrc) {\n            firstRtxSsrc = Number(ssrcs[1]);\n            return true;\n        }\n        else {\n            return false;\n        }\n    });\n    const ssrcCnameLine = offerMediaObject.ssrcs.find((line) => line.attribute === 'cname');\n    if (!ssrcCnameLine) {\n        throw new Error('a=ssrc line with cname information not found');\n    }\n    const cname = ssrcCnameLine.value;\n    const ssrcs = [];\n    const rtxSsrcs = [];\n    for (let i = 0; i < numStreams; ++i) {\n        ssrcs.push(firstSsrc + i);\n        if (firstRtxSsrc) {\n            rtxSsrcs.push(firstRtxSsrc + i);\n        }\n    }\n    offerMediaObject.ssrcGroups = [];\n    offerMediaObject.ssrcs = [];\n    offerMediaObject.ssrcGroups.push({\n        semantics: 'SIM',\n        ssrcs: ssrcs.join(' '),\n    });\n    for (const ssrc of ssrcs) {\n        offerMediaObject.ssrcs.push({\n            id: ssrc,\n            attribute: 'cname',\n            value: cname,\n        });\n        offerMediaObject.ssrcs.push({\n            id: ssrc,\n            attribute: 'msid',\n            value: `${streamId} ${trackId}`,\n        });\n    }\n    for (let i = 0; i < rtxSsrcs.length; ++i) {\n        const ssrc = ssrcs[i];\n        const rtxSsrc = rtxSsrcs[i];\n        offerMediaObject.ssrcs.push({\n            id: rtxSsrc,\n            attribute: 'cname',\n            value: cname,\n        });\n        offerMediaObject.ssrcs.push({\n            id: rtxSsrc,\n            attribute: 'msid',\n            value: `${streamId} ${trackId}`,\n        });\n        offerMediaObject.ssrcGroups.push({\n            semantics: 'FID',\n            ssrcs: `${ssrc} ${rtxSsrc}`,\n        });\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}